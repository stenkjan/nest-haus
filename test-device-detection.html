<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Device Detection Test - BALANCED FIX V3</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .info-box {
            background: #f0f0f0;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border: 2px solid #ddd;
        }
        .mobile { border-color: #4CAF50; background: #e8f5e9; }
        .desktop { border-color: #2196F3; background: #e3f2fd; }
        .tablet { border-color: #FF9800; background: #fff3e0; }
        h1 { color: #333; }
        .test-result {
            font-weight: bold;
            font-size: 1.2em;
            margin: 15px 0;
        }
        .details {
            font-size: 0.9em;
            color: #666;
            margin-top: 10px;
        }
        .viewport-info {
            background: #fff3cd;
            padding: 10px;
            margin: 10px 0;
            border-left: 4px solid #ffc107;
        }
        .critical-fix {
            background: #d1ecf1;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #0c5460;
            font-weight: bold;
        }
        .breakpoints {
            background: #e7f3ff;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #2196F3;
        }
    </style>
</head>
<body>
    <h1>üîç Device Detection Test - BALANCED FIX V3</h1>
    
    <div class="breakpoints">
        <strong>üìê Breakpoint Rules:</strong><br>
        ‚Ä¢ < 768px = Mobile (ALWAYS) ‚≠ê<br>
        ‚Ä¢ 768-1023px = Tablet/Desktop (check device)<br>
        ‚Ä¢ >= 1024px = Desktop (ALWAYS) ‚≠ê
    </div>
    
    <p><strong>Test Instructions:</strong></p>
    <ol>
        <li><strong>Test Mobile:</strong> Select iPhone 12 Pro (390px) ‚Üí Should show Mobile ‚úÖ</li>
        <li><strong>Test Tablet:</strong> Select iPad Mini (768px) ‚Üí Should show Tablet/Desktop ‚úÖ</li>
        <li><strong>Test Laptop:</strong> Select Laptop (1440px) ‚Üí Should show Desktop ‚úÖ</li>
    </ol>
    
    <div id="results"></div>

    <script>
        function detectDevice() {
            const width = window.innerWidth;
            
            // CRITICAL FIX #1: Viewport >= 1024px is ALWAYS desktop
            if (width >= 1024) {
                return {
                    isMobile: false,
                    isTablet: false,
                    isDesktop: true,
                    width,
                    rule: 'Viewport >= 1024px ‚Üí Desktop (Laptop/Desktop)',
                    priority: 'üî¥ Priority 1: Viewport Width'
                };
            }
            
            // CRITICAL FIX #2: Viewport < 768px is ALWAYS mobile
            if (width < 768) {
                return {
                    isMobile: true,
                    isTablet: false,
                    isDesktop: false,
                    width,
                    rule: 'Viewport < 768px ‚Üí Mobile (Phone)',
                    priority: 'üî¥ Priority 1: Viewport Width'
                };
            }
            
            // For medium range (768-1023px): Check device signals
            const userAgent = navigator.userAgent.toLowerCase();
            const isTabletUserAgent = /ipad|tablet/i.test(userAgent);
            const isMobileUserAgent = /android|iphone|ipod|blackberry|iemobile|opera mini/i.test(userAgent);
            
            const hasTouchScreen =
                "ontouchstart" in window ||
                navigator.maxTouchPoints > 0 ||
                (window.matchMedia && window.matchMedia("(pointer: coarse)").matches);

            const isTablet = isTabletUserAgent && hasTouchScreen;
            
            if (isTablet) {
                return {
                    isMobile: false,
                    isTablet: true,
                    isDesktop: false,
                    width,
                    rule: 'Tablet user agent + Touch in 768-1023px range',
                    priority: 'üü° Priority 2: Device Signals'
                };
            }
            
            // Default to desktop for this range
            return {
                isMobile: false,
                isTablet: false,
                isDesktop: true,
                width,
                rule: 'Medium viewport (768-1023px) ‚Üí Desktop',
                priority: 'üü¢ Priority 3: Default'
            };
        }

        function updateDisplay() {
            const detection = detectDevice();
            const resultsDiv = document.getElementById('results');
            
            const deviceType = detection.isMobile ? 'Mobile' : 
                              detection.isTablet ? 'Tablet' : 'Desktop';
            const boxClass = detection.isMobile ? 'mobile' : 
                            detection.isTablet ? 'tablet' : 'desktop';
            
            let criticalFixHtml = '';
            if (detection.width >= 1024) {
                criticalFixHtml = `
                    <div class="critical-fix">
                        ‚úÖ DESKTOP FIX ACTIVE: Viewport ${detection.width}px >= 1024px<br>
                        ‚Üí FORCED TO DESKTOP (Laptop/Desktop size)<br>
                        ‚Üí Ignores simulated touch events from DevTools
                    </div>
                `;
            } else if (detection.width < 768) {
                criticalFixHtml = `
                    <div class="critical-fix" style="background: #e8f5e9; border-left-color: #4CAF50;">
                        ‚úÖ MOBILE FIX ACTIVE: Viewport ${detection.width}px < 768px<br>
                        ‚Üí FORCED TO MOBILE (Phone size)<br>
                        ‚Üí Enables mobile testing in DevTools
                    </div>
                `;
            }
            
            resultsDiv.innerHTML = `
                ${criticalFixHtml}
                
                <div class="info-box ${boxClass}">
                    <div class="test-result">
                        ${detection.isMobile ? 'üì±' : detection.isTablet ? 'üì±' : 'üíª'} Device Type: ${deviceType}
                    </div>
                    <div class="details">
                        <strong>${detection.priority}</strong><br>
                        ${detection.rule}<br><br>
                        <strong>Detection Details:</strong><br>
                        ‚Ä¢ Width: ${detection.width}px<br>
                        ‚Ä¢ Mobile: ${detection.isMobile ? '‚úÖ' : '‚ùå'}<br>
                        ‚Ä¢ Tablet: ${detection.isTablet ? '‚úÖ' : '‚ùå'}<br>
                        ‚Ä¢ Desktop: ${detection.isDesktop ? '‚úÖ' : '‚ùå'}
                    </div>
                </div>
                
                <div class="viewport-info">
                    <strong>üìê Current Viewport:</strong> ${detection.width}px<br>
                    <strong>üì± Breakpoint:</strong> ${
                        detection.width < 768 ? '< 768px (Mobile)' :
                        detection.width < 1024 ? '768-1023px (Tablet range)' :
                        '>= 1024px (Desktop/Laptop)'
                    }<br>
                    <strong>üîß User Agent:</strong> <code style="font-size: 0.8em; word-break: break-all;">${navigator.userAgent}</code>
                </div>

                <div class="info-box">
                    <strong>üß™ Expected Results by DevTools Preset:</strong><br><br>
                    
                    <strong>Mobile Presets:</strong><br>
                    ‚Ä¢ iPhone 12 Pro (390px) ‚Üí Mobile ‚úÖ<br>
                    ‚Ä¢ iPhone SE (375px) ‚Üí Mobile ‚úÖ<br>
                    ‚Ä¢ Samsung Galaxy S20 (360px) ‚Üí Mobile ‚úÖ<br><br>
                    
                    <strong>Tablet Presets:</strong><br>
                    ‚Ä¢ iPad Mini (768px) ‚Üí Tablet/Desktop ‚úÖ<br>
                    ‚Ä¢ iPad Air (820px) ‚Üí Tablet/Desktop ‚úÖ<br>
                    ‚Ä¢ Surface Pro 7 (912px) ‚Üí Tablet/Desktop ‚úÖ<br><br>
                    
                    <strong>Laptop Presets:</strong><br>
                    ‚Ä¢ Laptop (1440px) ‚Üí Desktop ‚úÖ<br>
                    ‚Ä¢ Laptop L (1024px) ‚Üí Desktop ‚úÖ<br><br>
                    
                    ${detection.width < 768 ? 
                        '<strong style="color: #4CAF50;">‚úÖ MOBILE SIZE DETECTED!</strong><br>Viewport < 768px correctly shows Mobile' :
                        detection.width >= 1024 ?
                        '<strong style="color: #2196F3;">‚úÖ LAPTOP SIZE DETECTED!</strong><br>Viewport >= 1024px correctly shows Desktop' :
                        '<strong style="color: #FF9800;">‚úÖ TABLET SIZE DETECTED!</strong><br>Viewport in tablet range (768-1023px)'
                    }
                </div>
            `;
        }

        // Update on load
        updateDisplay();

        // Update on resize with debounce
        let resizeTimer;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(updateDisplay, 150);
        });
    </script>
</body>
</html>
